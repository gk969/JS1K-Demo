<html>
	<head>
		<title>JS1K Demo</title>
		<meta charset="utf-8">
	</head>
	
	<body>
		<canvas id="c" width="1024" height="768">
		<script>
      var a = document.getElementsByTagName('canvas')[0];
      var b = document.body;
      var d = function(e){ return function(){ e.parentNode.removeChild(e); }; }(a);
      // unprefix some popular vendor prefixed things (but stick to their original name)
      var AudioContext =
        window.AudioContext ||
          window.webkitAudioContext;
      var requestAnimationFrame =
        window.requestAnimationFrame ||
          window.mozRequestAnimationFrame ||
          window.webkitRequestAnimationFrame ||
          window.msRequestAnimationFrame ||
          function(f){ setTimeout(f, 1000/30); };
      // fix bug in safari: http://qfox.nl/weblog/218
      document.body.clientWidth;
      // auto resize (original) canvas. call `onresize(w,h) to limit the size of the canvas
      (window.onorientationchange = window.onresize = function(a){
        var mw = Infinity;
        var mh = Infinity;
        var min = Math.min;

        return function(w,h){
          if (arguments.length === 2) {
            mw = w;
            mh = h;
          }
          a.style.width = (a.width = min(mw, innerWidth)) + 'px';
          a.style.height = (a.height = min(mh, innerHeight)) + 'px';
        };
      }(a))();

      var c = a.getContext('2d');
    
		</script>
		
		<script>
Y = 600;
Z = 99;

function k(e, f, k) {
    m = [];
    for (D = 0; 9 > D; D++) G = p[2 * D] * e + p[2 * D + 1] * f, B = D ? 5 > D ? 1 / 9 : 1 / 36 : 4 / 9, m[D] = B * k * (1 + 3 * G + 4.5 * G * G - 1.5 * (e * e + f * f))
}
with(Math) S = sqrt, P = pow, F = floor, A = abs;
l = [], m = [], r = 1, p = [0, 0, 1, 0, 0, -1, -1, 0, 0, 1, 1, -1, -1, -1, -1, 1, 1, 1];
I = c.createImageData(Y, Y);
s = 0, x = 0;
a.onmousemove = function(e) {
    t = e.layerX;
    u = e.layerY;
    v = t - s;
    w = u - x;
    for (O = 0; 36 > O; O++) g = F(t / 6 + O / 6), h = F(u / 6) + O % 6, 0 < g && 98 > g && 0 < h && 98 > h && (J = l[g + Y * h], k(v && v / A(v) / 20, w && w / A(w) / 20, J.c), J.a = m);
    s = t;
    x = u
};
(function y() {
    L = I.data;
    for (n = 0; Z * Z > n; n++) {
        f = F(n / Z);
        e = n % Z;
        r && (k(0, 0, 1), l[e + Y * f] = {
            b: [],
            a: m,
            c: 1,
            x: 0,
            y: 0
        });
        M = l[e + Y * f];
        C = M.a;
        T = C[1] + C[5] + C[8];
        U = C[3] + C[6] + C[7];
        W = T + U + C[0] + C[2] + C[4];
        M.x = (T - U) / W;
        M.y = (C[4] + C[7] + C[8] - C[2] - C[5] - C[6]) / W;
        M.c = W;
        k(M.x, M.y, W);
        for (i = 0; 9 > i; i++) M.b[i] = C[i] + 1 * (m[i] - C[i]);
        for (i = 0; 36 > i; i++) V = 4 * (i % 6 + 6 * e + Y * (F(i / 6) + 6 * f)), q = l[e + Y * f], L[V + 1] = 5E3 * S(P(q.x, 2) + P(q.y, 2)), L[V + 3] = Y
    }
    c.putImageData(I, 0, 0);
    for (Q = r = 0; Z * Z > Q; Q++)
        for (f = F(Q / Z), e = Q % Z, K = 0; 9 > K; K++) N = p[2 * K] + e, R = p[2 * K + 1] + f, 0 < N && Z > N && 0 < R && Z > R && (l[N + Y * R].a[K] = l[e + Y * f].b[K]);
    requestAnimationFrame(y)
})()
		</script>
		
	</body>
</html>
	