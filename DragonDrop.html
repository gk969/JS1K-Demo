<html>
	<head>
		<title>JS1K Demo</title>
		<meta charset="utf-8">
	</head>
	
	<body>
		<canvas id="c" width="1024" height="768">
		<script>
      var a = document.getElementsByTagName('canvas')[0];
      var b = document.body;
      var d = function(e){ return function(){ e.parentNode.removeChild(e); }; }(a);
      // unprefix some popular vendor prefixed things (but stick to their original name)
      var AudioContext =
        window.AudioContext ||
          window.webkitAudioContext;
      var requestAnimationFrame =
        window.requestAnimationFrame ||
          window.mozRequestAnimationFrame ||
          window.webkitRequestAnimationFrame ||
          window.msRequestAnimationFrame ||
          function(f){ setTimeout(f, 1000/30); };
      // fix bug in safari: http://qfox.nl/weblog/218
      document.body.clientWidth;
      // auto resize (original) canvas. call `onresize(w,h) to limit the size of the canvas
      (window.onorientationchange = window.onresize = function(a){
        var mw = Infinity;
        var mh = Infinity;
        var min = Math.min;

        return function(w,h){
          if (arguments.length === 2) {
            mw = w;
            mh = h;
          }
          a.style.width = (a.width = min(mw, innerWidth)) + 'px';
          a.style.height = (a.height = min(mh, innerHeight)) + 'px';
        };
      }(a))();

      var c = a.getContext('2d');
    
		</script>
		
		<script>
function n(l) {
    l(0);
    l(1);
    l(2);
    l(3)
}

function p(l) {
    u = l.pageX;
    v = l.pageY;
    n(function(l) {
        b[l].c && (b[l].x = u - 32, b[l].y = v + 24)
    });
    d.c || q(d, j);
    e.c || q(e, g)
}
with(b) onmousemove = p, addEventListener("touchstart", onmousedown = function(l) {
    l.touches && p(l.touches[0]);
    n(function(l) {
        b[l].c = b[l].x > u - 64 && b[l].y > v && b[l].x < u && b[l].y < v + 64
    })
}), addEventListener("touchend", onmouseup = function() {
    n(function(l) {
        b[l].c = 0
    })
}), addEventListener("touchmove", function(l) {
    l.preventDefault();
    p(l.touches[0])
});
k = a;
b = [];
w = k.width;
h = k.height;
n(function(l) {
    e = d;
    f = a;
    d = b[l] = document.createElement("canvas");
    d.width = w;
    d.height = h;
    a = d.d = d.getContext("2d");
    d.c = 0
});
g = b[0];
j = b[1];
M = Math;
d.a = M.PI / 4;
e.a = 3 * d.a;
d.b = e.b = -2 / 3;
d.x = 2 / 3 * w;
d.y = e.y = h / 2;
e.x = w - d.x;

function r(l) {
    with(f) save(), translate(l.x, l.y), rotate(-l.a), scale(l.b, l.b), translate(-w / 2, -h / 2), globalCompositeOperation = "lighter", drawImage(d, 0, 0), fillStyle = "#010203", fillRect(0, 0, w, h), restore()
}

function q(l, m) {
    l.a = M.atan2(m.x - l.x, m.y - l.y);
    l.b = M.sqrt((l.x - m.x) * (l.x - m.x) + (l.y - m.y) * (l.y - m.y)) / h * 2
}

function s(l, m) {
    m.x = l.x + M.sin(l.a) * h * l.b / 2;
    m.y = l.y + M.cos(l.a) * h * l.b / 2
}
t = 0;
(function x() {
    requestAnimationFrame(x);
    s(d, j);
    s(e, g);
    f.fillStyle = "#000";
    f.fillRect(0, 0, w, h);
    r(d);
    r(e);
    a.drawImage(e, 0, 0);
    c.drawImage(e, 0, 0);
    n(function(m) {
        c.fillStyle = m % 2 ? "#80F" : "#F80";
        c.font = "64px a";
        c.fillText(2 > m ? "↻" : "☉", b[m].x, b[m].y)
    });
})();
		</script>
		
	</body>
</html>
	